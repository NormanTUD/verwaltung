#!/bin/bash
set -e

# Optional: Benutzer kann Port setzen, default = 1123
APP_PORT=${1:-1123}
ACTION=${2:-up}  # default: up, kann auch run_tests sein

echo "Aktion: $ACTION, APP_PORT=$APP_PORT"

# Prüfen, ob neo4j-db Container existiert
if [ "$(docker ps -a -q -f name=neo4j-db)" ]; then
    echo "Neo4j Container existiert bereits, benutze vorhandenen Container ..."
    docker start neo4j-db || true
fi

# Aktion auswählen
case "$ACTION" in
    up)
        echo "Starte Docker-Compose für Python-App..."
        APP_PORT=$APP_PORT docker-compose up --build python-app
        ;;
    run_tests)
        echo "Führe Tests im Python-Container aus..."
        APP_PORT=$APP_PORT docker-compose up --build python-app
        docker-compose run --rm python-app pytest
        ;;
    *)
        echo "Unbekannte Aktion: $ACTION"
        echo "Verfügbare Aktionen: up, run_tests"
        exit 1
        ;;
esac
