<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Editor {{ node_type }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="p-5">
    <h1>{{ node_type }} Editor</h1>
    <table class="table table-bordered" id="nodes-table">
        <thead><tr id="header-row"></tr></thead>
        <tbody></tbody>
    </table>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
    let node_type = "{{ node_type }}";

    function loadNodes() {
        $.get("/api/nodes/"+node_type, function(data){
            let tbody = $("#nodes-table tbody");
            let thead = $("#header-row");
            tbody.empty(); thead.empty();
            if(data.length==0){ return; }
            let keys = Object.keys(data[0].properties);
            keys.unshift("id");
            keys.forEach(k=>thead.append("<th>"+k+"</th>"));
            data.forEach(n=>{
                let row = "<tr>";
                keys.forEach(k=>{
                    let val = k=="id" ? n.id : n.properties[k] || "";
                    let type = typeof val=="number" ? "number" : "text";
                    row += `<td><input type="${type}" data-id="${n.id}" data-key="${k}" value="${val}"></td>`;
                });
                row += "</tr>";
                tbody.append(row);
            });
        });
    }

    $(document).on("change", "#nodes-table input", function(){
        let id = $(this).data("id");
        let key = $(this).data("key");
        let value = $(this).val();
        if($(this).attr("type")=="number") value = Number(value);
        let data = {}; data[key] = value;
        $.ajax({
            url: "/api/nodes/"+node_type+"/"+id,
            method: "POST",
            contentType: "application/json",
            data: JSON.stringify(data)
        });
    });

    $(document).ready(loadNodes);
    </script>
</body>
</html>
