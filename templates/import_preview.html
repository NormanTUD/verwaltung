{% extends "layout.html" %}
{% block title %}Importvorschau{% endblock %}

{% block content %}
<h2>Importvorschau</h2>

<form action="{{ url_for('import_commit') }}" method="post" id="importForm">
    <table border="1" cellpadding="5" cellspacing="0" dont_sort="1">
        <thead>
            <tr>
                {% for col in columns %}
                <th>
                    {{ col }}<br>
                    <select name="column_map[{{ col }}]">
                        <option value="">-- Ignorieren --</option>
                        {% for target in possible_targets %}
                            <option value="{{ target }}" {% if column_map[col] == target %}selected{% endif %}>{{ target }}</option>
                        {% endfor %}
                    </select>
                </th>
                {% endfor %}
            </tr>
        </thead>
        <tbody>
            {% for row in rows %}
                <tr>
                    {% for col in columns %}
                        <td>{{ row[col] }}</td>
                    {% endfor %}
                </tr>
            {% endfor %}
        </tbody>
    </table>

    <input type="hidden" name="data_json" id="data_json_input" value="">

    <button type="submit">Import starten</button>
</form>

<script>
document.addEventListener("DOMContentLoaded", function() {
    var data = {{ data_json | tojson | safe }};
    var form = document.getElementById("importForm");
    form.addEventListener("submit", function(event) {
        var jsonString = JSON.stringify(data);
        document.getElementById("data_json_input").value = jsonString;
    });
});
</script>

{% endblock %}
