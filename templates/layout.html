<!DOCTYPE html>
<html lang="de" class="no-js transition-colors duration-500">
	<head>
		<meta charset="UTF-8">
		<title>{% block title %}Meine Seite{% endblock %}</title>
		<meta name="viewport" content="width=device-width, initial-scale=1">

		<link href="/static/bootstrap.min.css" rel="stylesheet">
		<link rel="stylesheet" href="/static/style.css">
		<script src="/static/jquery.min.js" defer></script>

		<!-- Tailwind CDN -->
		<script src="https://cdn.tailwindcss.com"></script>
		<script>
			tailwind.config = {
				darkMode: 'class',
				theme: {
					extend: {
						transitionProperty: {
							'width': 'width',
							'spacing': 'margin, padding'
						}
					}
				}
			};
		</script>

		<!-- Notification Style -->
		<style>
			.toast {
				position: fixed;
				top: 1rem;
				right: 1rem;
				background-color: #1f2937;
				color: white;
				padding: 0.75rem 1.25rem;
				border-radius: 0.5rem;
				box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
				z-index: 9999;
			}
		</style>
	</head>
	<body class="bg-white dark:bg-gray-900 text-gray-900 dark:text-white transition-all duration-500 flex" style='height: fit-content;'>

		<!-- Sidebar -->
		<nav id="sidebar" class="bg-gray-800 text-white w-64 min-h-screen p-4 space-y-4 invisible">
			<h2 class="text-2xl font-bold mb-6"><a href='/'>Verwaltung</a></h2>

			<ul class="space-y-2">
				<li class="text-sm text-gray-400 uppercase">üßô Wizards</li>
				{% for route in wizard_routes %}
				<li>
					<a href="{{ route }}" class="block px-4 py-2 rounded transition hover:bg-gray-700 {% if request.path == route %}bg-gray-700{% endif %}">
						{{ route.replace('/wizard/', '').capitalize() }}
					</a>
				</li>
				{% endfor %}

				<li class="mt-4 text-sm text-gray-400 uppercase">üì¶ Aggregate</li>
				<li><a href="{{ url_for('aggregate_inventory_view') }}" class="block px-4 py-2 rounded transition hover:bg-gray-700 {% if request.path == url_for('aggregate_inventory_view') %}bg-gray-700{% endif %}">Inventar</a></li>
				<li><a href="{{ url_for('aggregate_transponder_view') }}" class="block px-4 py-2 rounded transition hover:bg-gray-700 {% if request.path == url_for('aggregate_transponder_view') %}bg-gray-700{% endif %}">Transponder</a></li>

				<li class="mt-4 text-sm text-gray-400 uppercase">üìã Tabellen</li>
				{% for table in tables %}
				<li>
					<a href="{{ url_for('table_view', table_name=table) }}" class="block px-4 py-2 rounded transition hover:bg-gray-700 {% if request.path == url_for('table_view', table_name=table) %}bg-gray-700{% endif %}">
						{{ table.capitalize() }}
					</a>
				</li>
				{% endfor %}

				<li class="mt-4 text-sm text-gray-400 uppercase">üó∫Ô∏è Karten</li>
				<li><a href="/map-editor" class="block px-4 py-2 rounded transition hover:bg-gray-700 {% if request.path == '/map-editor' %}bg-gray-700{% endif %}">Map-Editor</a></li>
				<li><a href="/floorplan" class="block px-4 py-2 rounded transition hover:bg-gray-700 {% if request.path == '/floorplan' %}bg-gray-700{% endif %}">Floorplan</a></li>
			</ul>

			<div class="pt-6 space-y-2">
				<!-- Theme toggle: IMMER sichtbar -->
				<button id="toggleThemeBtn" class="w-full bg-gray-700 hover:bg-gray-600 py-2 rounded transition">üåì Theme</button>

				{% if is_authenticated %}
					<!-- Logout-Link statt Button -->
					<a href="/logout" class="w-full block text-center bg-red-600 hover:bg-red-500 py-2 rounded transition text-white">üö™ Logout</a>

					{% if is_admin %}
						<!-- Admin-Link nur f√ºr Admins -->
						<a href="/admin" class="w-full block text-center bg-blue-700 hover:bg-blue-600 py-2 rounded transition text-white">üõ†Ô∏è Admin</a>
					{% endif %}
				{% else %}
					<!-- Login-Link -->
					<a href="/login" class="w-full block text-center bg-green-700 hover:bg-green-600 py-2 rounded transition text-white">üîê Login</a>
				{% endif %}
			</div>



		</nav>

		<!-- Main Content -->
		<main class="flex-grow p-6 transition-all duration-500">
			{% block content %}
			<h1 class="text-3xl font-bold">Willkommen</h1>
			{% endblock %}
		</main>

		<!-- Toast -->
		<div id="toast" class="toast hidden"></div>

		<!-- Scripts -->
		<script defer>
			var theme = "light";
			document.documentElement.classList.remove('no-js');
			
			function applyInvertFilterToElements(mode) {
				const floorplan = document.getElementById('floorplan');
				const backgroundImage = document.getElementById('backgroundImage');

				if (floorplan) {
					floorplan.style.filter = (mode === 'dark') ? 'invert(1)' : '';
				}
				if (backgroundImage) {
					backgroundImage.style.filter = (mode === 'dark') ? 'invert(1)' : '';
				}

				const inputs = document.querySelectorAll('input, textarea, button');
				inputs.forEach(function(element) {
					if (mode === 'dark') {
						element.style.backgroundColor = '#1a202c';  // dunkelgrau
						element.style.color = '#f7fafc';            // hell
						element.style.borderColor = '#2d3748';     // Rahmen
					} else {
						element.style.backgroundColor = '';
						element.style.color = '';
						element.style.borderColor = '';
					}
				});

				// Speziell f√ºr Select-Elemente: 
				const selects = document.querySelectorAll('select');
				selects.forEach(function(element) {
					if (mode === 'dark') {
						element.style.backgroundColor = '#1a202c';
						element.style.color = '#f7fafc';
						element.style.borderColor = '#2d3748';
						element.style.appearance = 'none';        // Entfernt systemeigenes Styling
						element.style.webkitAppearance = 'none';  // Safari
						element.style.mozAppearance = 'none';     // Firefox

						$("select").css("background-color", "1a202c")
					} else {
						element.style.backgroundColor = '';
						element.style.color = '';
						element.style.borderColor = '';
						element.style.appearance = '';
						element.style.webkitAppearance = '';
						element.style.mozAppearance = '';
						
						$("select").css("background-color", "unset")
					}
				});
			}

			document.addEventListener('DOMContentLoaded', function () {
				try {
					const html = document.documentElement;
					const toast = document.getElementById('toast');
					const sidebar = document.getElementById('sidebar');
					const main = document.querySelector('main');
					const toggleThemeBtn = document.getElementById('toggleThemeBtn');
					const logoutBtn = document.getElementById('logoutBtn');

					if (!main) {
						console.error('Element <main> nicht gefunden.');
						return;
					}
					if (!toggleThemeBtn) {
						console.error('Button zum Umschalten des Themes (toggleThemeBtn) nicht gefunden.');
						return;
					}
					if (!toast) {
						console.error('Toast-Element nicht gefunden.');
						return;
					}
					if (!sidebar) {
						console.error('Sidebar nicht gefunden.');
						// Weiter machen, da evtl. nicht kritisch
					}
					if (!logoutBtn) {
						console.warn('Logout-Button nicht gefunden.');
						// Weiter machen, falls kein Logout vorhanden
					}

					if (sidebar) {
						sidebar.classList.remove('invisible');
						sidebar.classList.add('transition-transform', 'duration-300');
					}

					function applyMainBgClass(mode) {
						if (mode === 'dark') {
							main.classList.add('bg-gray-900', 'text-gray-100');
							main.classList.remove('bg-white', 'text-gray-900');
						} else {
							main.classList.add('bg-white', 'text-gray-900');
							main.classList.remove('bg-gray-900', 'text-gray-100');
						}
					}

					function showToast(message) {
						toast.textContent = message;
						toast.classList.remove('hidden');
						toast.style.opacity = '1';
						setTimeout(() => {
							toast.style.opacity = '0';
							setTimeout(() => {
								toast.classList.add('hidden');
							}, 300);
						}, 2500);
					}

					function updateThemeButtonIcon() {
						const isDark = html.classList.contains('dark');
						toggleThemeBtn.textContent = isDark ? "‚òÄÔ∏è Light Mode" : "üåô Dark Mode";
					}

					function applyTheme(mode) {
						theme = mode;
						if (mode === 'dark') {
							html.classList.add('dark');
							localStorage.setItem('theme', 'dark');
							applyMainBgClass('dark');
							applyInvertFilterToElements('dark');
							updateThemeButtonIcon();
							showToast("üåô Dark Mode aktiviert");
						} else {
							html.classList.remove('dark');
							localStorage.setItem('theme', 'light');
							applyMainBgClass('light');
							applyInvertFilterToElements('light');
							updateThemeButtonIcon();
							showToast("‚òÄÔ∏è Light Mode aktiviert");
						}
					}

					const storedTheme = localStorage.getItem('theme');
					const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;

					if (storedTheme) {
						applyTheme(storedTheme);
					} else if (prefersDark) {
						applyTheme('dark');
					} else {
						applyTheme('light');
					}

					toggleThemeBtn.addEventListener('click', function () {
						const isDark = html.classList.contains('dark');
						applyTheme(isDark ? 'light' : 'dark');
					});

					if (logoutBtn) {
						logoutBtn.addEventListener('click', function () {
							showToast("üö™ Ausgeloggt");
							// window.location.href = "/logout"; // Optional aktivieren
						});
					}
				} catch (error) {
					console.error('Fehler im Theme-Script:', error);
				}
			});

		</script>

		<script src="/static/footer.js" defer></script>
	</body>
</html>
