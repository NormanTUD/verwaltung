<!DOCTYPE html>
<html lang="de" class="no-js transition-colors {% if theme == 'dark' %}dark{% endif %}">
	<head>
		<meta charset="UTF-8">
		<title>Verwaltung &mdash; {% block title %}Meine Seite{% endblock %}</title>
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link href="/static/bootstrap.min.css" rel="stylesheet">
		<link rel="stylesheet" href="/static/style.css">
		<link rel="stylesheet" href="/static/flatpickr.min.css">
		<script src="/static/tailwind.js"></script>
		<script src="/static/tailwind_config.js"></script>
		<script src="/static/flatpickr.js"></script>

		<script src="static/jquery-3.6.4.min.js"></script>

		<script src="static/jquery-extendext.min.js"></script>

		<link rel="stylesheet" href="static/bootstrap.min.css">
		<script src="static/bootstrap.bundle.min.js"></script>

		<link rel="stylesheet" href="static/query-builder.default.min.css">
		<script src="static/query-builder.standalone.min.js"></script>

		<script src="static/overview/jqueryquerybuilder.js"></script>

		<script>
			const log = console.log;
		</script>
		<link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}" type="image/x-icon">
		<script src="{{ url_for('static', filename='toaster.js') }}"></script>
		<script src="static/d3.v7.min.js"></script>
		<script src="static/overview/url_states.js"></script>

		<style>
			.form-control::placeholder{
				color: gray!important;
			}
			
			.form-control::-webkit-input-placeholder{
				color:gray!important;
			}
			
			.form-control::-moz-placeholder{
				color:gray!important;
			}
			
			.form-control:-ms-input-placeholder{
				color:gray!important;
			}
			
			.form-control:-moz-placeholder{
				color:gray!important
			}
		</style>
	
		<script src="static/main_functions.js"></script>
	</head>
	<body class="bg-{% if theme == 'dark' %}black{% else %}white{% endif %} dark:bg-gray-900 text-gray-900 dark:text-white transition-all flex" style='height: fit-content;'>
		{% if is_authenticated %}
			<!-- Sidebar -->
			<nav id="sidebar" class="bg-gray-800 text-white w-64 min-h-screen p-4 space-y-4 invisible">
				<h2 class="text-2xl font-bold mb-6"><a href='/'><span id="emoji">🗂️</span> OASIS</a></h2>

				<p>Organization of Assets & Staff Integration System</a>

				<div>
					<input
					  type="text"
					  id="sidebarSearch"
					  placeholder="🔍 Suchen..."
					  class="w-full px-3 py-2 rounded border text-white bg-gray-800 border-blue-400"
					/>

					<ul id="sidebarSearchResults" class="bg-{% if theme == 'dark' %}black{% else %}white{% endif %} text-{% if theme == 'dark' %}white{% else %}black{% endif %} rounded mt-1 max-h-60 overflow-auto shadow-lg hidden absolute z-50 w-60"></ul>
				</div>

				<div class="space-y-2">
					<!-- Theme toggle: IMMER sichtbar -->
					<button id="toggleThemeBtn" class="w-full bg-gray-700 hover:bg-gray-600 py-2 rounded transition">🌓 Theme</button>
				</div>

				<ul class="space-y-2">
					<li><a href="/overview" class="block px-4 py-2 rounded transition hover:bg-gray-700 {% if request.path == '/overview' %}bg-gray-700{% endif %}">Overview</a></li>

					<li class="mt-4 text-sm text-gray-400 uppercase">🗺️ Karten</li>
					{% if is_admin %}
						<li><a href="/map-editor" class="block px-4 py-2 rounded transition hover:bg-gray-700 {% if request.path == '/map-editor' %}bg-gray-700{% endif %}">Map-Editor</a></li>
					{% endif %}
					<li><a href="/floorplan" class="block px-4 py-2 rounded transition hover:bg-gray-700 {% if request.path == '/floorplan' %}bg-gray-700{% endif %}">Floorplan</a></li>
				</ul>
				
				{% if saved_queries %}
					<div class="mt-6">
						<p class="mt-4 mb-2 text-sm text-gray-400 uppercase">💾 Gespeicherte Abfragen</p>
						<ul class="space-y-1">
							{% for query in saved_queries %}
								<li>
									<a href="{{ query.url }}" 
									class="block px-4 py-2 rounded transition hover:bg-gray-700 {% if request.full_path == query.url %}bg-gray-700{% endif %}">
										{{ query.name }}
									</a>
								</li>
							{% endfor %}
						</ul>
					</div>
				{% endif %}

				{% if is_admin %}
					<!-- Admin-Link nur für Admins -->
					<a href="/import" class="w-full block text-center bg-blue-700 hover:bg-blue-600 py-2 rounded transition text-white">📥 Import</a>

					<a href="/admin" class="w-full block text-center bg-blue-700 hover:bg-blue-600 py-2 rounded transition text-white">🛠️ Admin</a>
				{% endif %}

				<a href="/logout" class="w-full block text-center bg-red-600 hover:bg-red-500 py-2 rounded transition text-white">🚪 Logout</a>
				
				<!-- Versions-Slider -->
				<div class="mb-6"><div id="versionContainer" style="display:none;">
					<div class="mb-6">
						<label for="versionSlider" class="block mb-1 font-semibold">Daten-Version auswählen:</label>
						<input
						type="range"
						id="versionSlider"
						min="0"
						max="0"
						step="1"
						value="0"
						class="w-full"
						oninput="updateVersionLabel(this.value)"
						disabled
						/>
						<div class="flex justify-between text-xs text-gray-600 mt-1">
						<span>Älteste</span>
						| <span id="versionLabel">Lädt...</span> | 
						<span>Neueste</span>
						</div>
						<button
						id="applyVersionBtn"
						class="mt-2 px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700 transition"
						onclick="applyVersion()"
						disabled
						>
						Version laden
						</button>
					</div>
				</div>

				<div id="noVersionsMessage" style="display:none; color: red; font-weight: bold;">
					Keine Versionen gefunden.
				</div>
			</nav>
		{% else %}
			NA
		{% endif %}

		<!-- Main Content -->
		<main class="flex-grow p-6 transition-all overflow-auto">
		{% block content %}
		<div class="inline-block whitespace-nowrap">
			<h1 class="text-3xl font-bold">Willkommen</h1>
			<!-- Mehr Content hier, der die Breite erweitert -->
		</div>
		{% endblock %}
		
		<footer class="mt-12 text-center text-sm text-gray-500 dark:text-gray-400 space-x-4">
			<a href="https://scads.ai/imprint/" target="_blank" rel="noopener noreferrer" class="hover:underline">Impressum</a>
			<a href="mailto:norman.koch@tu-dresden.de" class="hover:underline">Norman Koch</a>
			<a href="mailto:lian.menzel@tu-dresden.de" class="hover:underline">Lian Menzel</a>
		</footer>
		</main>


		<!-- Scripts -->
		<script src="/static/layout.js" defer></script>
		<script src="/static/footer.js" defer></script>
		<script src="/static/table_sorter.js" defer></script>
	</body>
</html>
