{% if not request.headers.get('X-Requested-With') == 'XMLHttpRequest' %}
    {% extends "layout.html" %}
{% endif %}

{% block title %}Daten zuordnen{% endblock %}

{% block content %}
    <h1>Daten zuordnen</h1>
    <p>Ordne die Spalten den Node-Typen und Relationships zu. Jede Spalte muss einem Node-Typen zugeordnet werden, um Relationships zu erstellen.</p>

    <div id="mappingContainer">
        <div id="nodeMappings" class="mapping-section">
            <h2 class="section-title">Node-Zuordnung</h2>
            <div id="nodeList"></div>
            <button type="button" onclick="addNodeMapping()">+ Neuer Node-Typ</button>
        </div>

        <div id="relationshipMappings" class="mapping-section">
            <h2 class="section-title">Relationships</h2>
            <div id="relationshipList"></div>
            <button type="button" onclick="addRelationship()">+ Relationship hinzuf√ºgen</button>
        </div>
    </div>
    
    <button type="button" onclick="saveMapping()" class="save-button">Speichern & Importieren</button>
    
    <style>
        body { font-family: sans-serif; }
        .mapping-section { border: 1px solid #ccc; padding: 15px; margin-bottom: 20px; border-radius: 8px; }
        .section-title { margin-top: 0; color: #333; }
        .node-group, .relationship-group { border: 1px solid #eee; padding: 10px; margin-bottom: 10px; border-radius: 6px; background-color: #f9f9f9; }
        .node-group h4 { color: #0056b3; margin-top: 0; }
        .relationship-group h4 { color: #28a745; margin-top: 0; }
        .node-group .node-label-input, .rel-type-input { font-weight: bold; }
        .column-list { display: flex; flex-wrap: wrap; gap: 5px; margin-top: 5px; }
        .column-item { 
            background-color: #e2e6ea; border: 1px solid #d3d9df; padding: 5px 10px; border-radius: 4px; cursor: pointer; user-select: none;
            display: flex; align-items: center;
        }
        .column-item.selected { background-color: #007bff; color: white; border-color: #007bff; }
        .column-item.disabled { background-color: #f0f0f0; color: #999; border-color: #ddd; cursor: not-allowed; text-decoration: line-through; }
        .save-button { padding: 10px 20px; font-size: 16px; background-color: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
        .save-button:hover { background-color: #0056b3; }
        .remove-button { margin-left: 10px; color: #dc3545; cursor: pointer; }
        .property-input { 
            font-size: 12px; padding: 2px; margin-left: 5px;
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.5);
            border-radius: 3px;
            color: white;
            display: none;
            width: 80px;
        }
        .column-item.selected .property-input { display: inline-block; }
        .rel-type-input { display: none; margin-left: 10px; }
    </style>

    <script>
        var headers = {{ headers|tojson }};
    </script>
    <script src="static/mapping.js"></script>

    <script>
	load_mapping();
    </script>
{% endblock %}
