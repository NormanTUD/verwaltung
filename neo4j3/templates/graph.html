<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Neo4j Graph Visualisierung</title>
    <style>
        body { margin: 0; }
        svg { background: #f0f0f0; }
        .link { stroke: #999; stroke-opacity: 0.6; }
        .node circle { stroke: #fff; stroke-width: 1.5px; }
        .node text { font: 10px sans-serif; pointer-events: none; }
    </style>
    <script src="https://d3js.org/d3.v7.min.js"></script>
</head>
<body>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const width = window.innerWidth;
            const height = window.innerHeight;

            const svg = d3.select("body").append("svg")
                .attr("width", width)
                .attr("height", height);

            const simulation = d3.forceSimulation()
                .force("link", d3.forceLink().id(d => d.id))
                .force("charge", d3.forceManyBody().strength(-400))
                .force("center", d3.forceCenter(width / 2, height / 2));

            fetch('/api/graph-data')
                .then(response => response.json())
                .then(graph => {
                    if (graph.error) {
                        console.error(graph.error);
                        return;
                    }

                    const nodes = graph.nodes;
                    const links = graph.links;

                    const link = svg.append("g")
                        .attr("class", "links")
                        .selectAll("line")
                        .data(links)
                        .enter().append("line")
                        .attr("class", "link");

                    const node = svg.append("g")
                        .attr("class", "nodes")
                        .selectAll("circle")
                        .data(nodes)
                        .enter().append("circle")
                        .attr("r", 5)
                        .attr("fill", d => d.label === 'Movie' ? 'red' : 'blue') // Beispiel: Farbe basierend auf Node-Label
                        .call(d3.drag()
                            .on("start", dragstarted)
                            .on("drag", dragged)
                            .on("end", dragended));

                    node.append("title")
                        .text(d => JSON.stringify(d.properties, null, 2));

                    simulation.nodes(nodes).on("tick", ticked);
                    simulation.force("link").links(links);

                    function ticked() {
                        link
                            .attr("x1", d => d.source.x)
                            .attr("y1", d => d.source.y)
                            .attr("x2", d => d.target.x)
                            .attr("y2", d => d.target.y);

                        node
                            .attr("cx", d => d.x)
                            .attr("cy", d => d.y);
                    }
                })
                .catch(error => console.error('Error fetching graph data:', error));

            function dragstarted(event, d) {
                if (!event.active) simulation.alphaTarget(0.3).restart();
                d.fx = d.x;
                d.fy = d.y;
            }

            function dragged(event, d) {
                d.fx = event.x;
                d.fy = event.y;
            }

            function dragended(event, d) {
                if (!event.active) simulation.alphaTarget(0);
                d.fx = null;
                d.fy = null;
            }
        });
    </script>
</body>
</html>
